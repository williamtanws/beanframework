<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout">
<head>
<body>
	<th:block th:fragment="datatable (title, tableId, columnsi18n)">
		<!-- Main content -->
		<section class="content">
			<div class="container-fluid">
				<div class="row">
					<div class="col-12">
						<div class="card">
							<!-- /.card-header -->
							<div class="card-body">
								<table th:id="${tableId}" class="table table-bordered table-striped">
									<thead>
										<tr>
											<th th:each="column : ${columnsi18n}" th:text="${column}"></th>
											<th th:text="#{module.common.action}"></th>
										</tr>
									</thead>
								</table>
							</div>
							<!-- /.card-body -->
						</div>
						<!-- /.card -->
					</div>
				</div>
			</div>
		</section>

		<div class="modal fade" th:id="'modal-form-'+${tableId}">
			<div class="modal-dialog modal-xl">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title" th:text="${title}"></h4>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<iframe src="" th:id="'modal-form-iframe-'+${tableId}" style="border: none; width: 100%; height: 100%; min-height: 400px"></iframe>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal-dialog -->
		</div>
		<!-- /.modal -->

	</th:block>
	<th:block th:fragment="js (tableId, columns, pageUrl, formUrl)">

		<script th:inline="javascript">
		/*<![CDATA[*/
		
		var tableId = /*[[${tableId}]]*/;
		var pageUrl = /*[[${pageUrl}]]*/;
		var formUrl = /*[[${formUrl}]]*/;
			
		$("#modal-form-"+tableId+",#modal-delete-"+tableId).on('hidden.bs.modal', function () {
			$("#"+tableId).DataTable().ajax.reload(null, false);
		})
		
		var modalForm = "#modal-form-"+tableId;
		var modalFormDelete = "#modal-form-delete-"+tableId;
		var modalFormIframe = "#modal-form-iframe-"+tableId;
			
		function addItem(){
			$(modalFormIframe).attr('src', formUrl);					
	    	$(modalForm).modal('show');
		}
			
		function editItem(uuid){
			$(modalFormIframe).attr('src', formUrl+"?uuid="+uuid);					
	    	$(modalForm).modal('show');
		}
		
		$(document).ready(function() {

		    $("#"+tableId).DataTable( {
		    	"lengthMenu": [ [10, 25, 50, -1], [10, 25, 50, "All"] ],
		    	"responsive" : true,
				'pageLength'  : 10,
	    	    'paging'      : true,
	    	    'lengthChange': true,
	    	    'searching'   : true,
	    	    'ordering'    : true,
	    	    'info'        : true,
	    	    'autoWidth'   : false,
	    	    'processing': true,
	    	    'serverSide': true,
	    	    'searchDelay': 1000,
		        'bStateSave': true,
		        'dom': "<'row'<'form-group col-sm-12 col-md-12'B>>" +
	    	      "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" +
	    	      "<'row'<'col-sm-12'tr>>" +
	    	      "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>", 
				'ajax': pageUrl,
		        "columns": [
            	    /*[# th:each="column : ${columns}"]*/
            	    { "data": /*[[${column}]]*/ },
                    /*[/]*/
		            { "data": "uuid" }
		        ],
		        "columnDefs": [
		        	{
		          		"targets": -1,
		         		'orderable': false,
		         		render: function(data, type, row, meta)
    	                {
    	                	return "<button type='button' class='btn btn-default' onclick=\"editItem('"+row.uuid+"')\">Edit</button>"; 
    	                }
		        	}
		        
		        ],
		        "buttons": [
		        	{
		                text: 'Add',
		                action: function ( e, dt, node, config ) {
		                    addItem();
		                }
		            },
		            {
		                extend: 'csv',
		                text: 'Export CSV',
		                className: 'btn btn-default',
		                exportOptions: {
		                   columns: 'th:not(:last-child)'
		                }
		            },
		            {
		                extend: 'excel',
		                text: 'Export Excel',
		                className: 'btn btn-default',
		                exportOptions: {
		                   columns: 'th:not(:last-child)'
		                }
		            },
		            {
		                extend: 'pdf',
		                text: 'Export PDF',
		                className: 'btn btn-default',
		                exportOptions: {
		                   columns: 'th:not(:last-child)'
		                }
		            },
		            {
		                extend: 'print',
		                text: 'Print',
		                className: 'btn btn-default',
		                exportOptions: {
		                   columns: 'th:not(:last-child)'
		                }
		            },
		            {
		                extend: 'colvis',
		                text: 'Visibility',
		                className: 'btn btn-default'
		            },
		        	{
		                text: 'Refresh',
		                action: function ( e, dt, node, config ) {
		                	dt.clear().draw();
		                    dt.ajax.reload();
		                }
		            }
		    	]
		    });
		});
		
		/*]]>*/
		</script>
	</th:block>
</body>
</html>