<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout">
<body>
	<th:block layout:fragment="list (icon, title, objectUpdate, createAuthority, updateAuthority, tableName, listUrl, listFields, editFormAction, editForm, createButton)">
		<!-- Search Form
		<div class="row">
			<div class="col-md-6">
				<div class="box box-solid">
					<div class="box-body">
						<div class="box-tools">
							<div class="has-feedback">
								<input id="searchAll" type="text" class="form-control input-sm" th:placeholder="#{module.backoffice.searchall}">
								<span class="glyphicon glyphicon-search form-control-feedback"></span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>-->
		<!-- Alert Notification-->
		<div class="row">
			<th:block layout:insert="~{/common/adminlte/common/component/alert :: custom}"></th:block>
		</div>
		<div class="row">
			<div class="col-md-12">
				<div class="box box-solid">
					<!-- /.box-header -->
					<div class="box-group" id="accordion">
						<!-- we are adding the .panel class so bootstrap.js collapse plugin detects it -->
						<div class="panel box box-primary">
							<div class="box-header with-border">
								<h4 class="box-title">
									<a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" th:aria-expanded="${objectUpdate.uuid != null || create ? 'false':'true'}"
										th:class="${objectUpdate.uuid != null || create ? 'collapsed':''}">
										<span th:class="${icon}"></span>
										&nbsp;&nbsp;
										<span th:text="${title}+' ('"></span>
										<span id="total-records"></span>
										<span th:text="')'"></span>
										<i class="fa fa-fw fa-angle-double-down"></i>
									</a>
								</h4>
							</div>
							<div id="collapseOne" th:class="'panel-collapse collapse '+${objectUpdate.uuid != null || create ? '':'in'}">
								<div class="box-body">
									<div class="row">
										<div class="col-md-12">
											<div class="box-body bg-gray">
												<div class="row">
													<div class="col-md-6">
														<th:block th:if="${createButton == '1'}">
															<a th:href="${editFormAction}+'?create'" type="button" class="btn btn-default" th:if="${#authorization.expression('hasAuthority('''+createAuthority+''')')}">
																<span class="fa fa-plus color"></span>
															</a>
														</th:block>
													</div>
													<div class="col-md-6" style="text-align: right; line-height: 34px;">
														<span th:text="#{module.backoffice.show}"></span>
														<select id="length-change" class="text-block">
															<option value='10'>10</option>
															<option value='20'>20</option>
															<option value='50'>50</option>
															<option value='100'>100</option>
														</select>
														<span th:text="#{module.backoffice.entries}"></span>
													</div>
												</div>
												<!-- /.box-header -->
											</div>
										</div>
										<div class="col-md-12">
											<div class="dataTables_wrapper form-inline dt-bootstrap">
												<table id="mainTable" class="table table-bordered table-hover dataTable" style="width: 100%">
													<thead>
														<tr>
															<th th:each="field : ${listFields}" th:text="${field[1]}" class="text-center"></th>
														</tr>
													</thead>
													<thead>
														<tr>
															<th th:each="field : ${listFields}" class="text-center"></th>
														</tr>
													</thead>
												</table>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="panel box box-success" th:if="${objectUpdate.uuid != null || create}">
							<div class="box-header with-border">
								<h4 class="box-title">
									<a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" th:aria-expanded="${objectUpdate.uuid != null || create ? 'true':'false'}"
										th:class="${objectUpdate.uuid == null ? 'collapsed':''}">
										<span th:if="${objectUpdate.uuid != null}" th:text="'ID: '+${objectUpdate.id}"></span>
										<span th:if="${create}" th:text="#{module.backoffice.create}"></span>
										<i class="fa fa-fw fa-angle-double-down"></i>
									</a>
								</h4>
							</div>
							<div id="collapseTwo" th:class="'panel-collapse collapse '+${objectUpdate.uuid != null || create ? 'in':''}">
								<div class="box-body">
									<th:block layout:insert="~{${editForm} :: update}" th:if="${objectUpdate.uuid != null || create}"></th:block>
								</div>
							</div>
						</div>
					</div>
					<!-- /.box-body -->
				</div>
			</div>
			<form id="edit-form" th:action="${editFormAction}+'#tab_general'" method="get" th:object="${objectUpdate}" style="display: none">
				<input type="hidden" name="uuid">
			</form>
			<th:block layout:insert="~{/common/adminlte/common/component/list :: js}"></th:block>
		</div>
	</th:block>

	<th:block layout:fragment="js">
		<script th:inline="javascript">
		    /*<![CDATA[*/
		    	
		    var locale = /*[[${#locale}]]*/;
		    
		    var columns = [];
		    /*[# th:each="object,itrStat : ${listFields}"]*/  	    
		    columns.push({"data":[[${object[0]}]]});
		    /*[/]*/
		    
		    var tableName = /*[[${tableName}]]*/;
		    		    
		    var mainTable = $('#mainTable').DataTable({
	    		  'language' : {
			        'url' : '/static/common/plugin/datatables/language/'+locale+'.json'
			      },
	    	      'pageLength'  : 10,
	    	      'paging'      : true,
	    	      'lengthChange': true,
	    	      'searching'   : true,
	    	      'ordering'    : true,
	    	      'info'        : true,
	    	      'autoWidth'   : true,
	    	      'processing': true,
	    	      'serverSide': true,
	    	      'searchDelay': 1000,
	    	      'sDom': 'tipr', 
	    	      'bStateSave': true,
	    	      'orderCellsTop': true,
	    	      'fnStateSave': function (oSettings, oData) {
	    	            sessionStorage.setItem(tableName, JSON.stringify(oData));
	    	      },
	    	      'fnStateLoad': function (oSettings) {
	    	            return JSON.parse(sessionStorage.getItem(tableName));
	    	      },
	    	      'ajax': {
	                    'url':/*[[${listUrl}]]*/
	              },
	              'columns': columns,
	              'columnDefs': [
	            	  { 
	    	                targets: 0,
	    	                'className': 'text-bold'
	            	  },
	            	  {                                 
	                      "targets": '_all',
	                      "render": $.fn.dataTable.render.text()
	                  }
	              ],
	    	      'fnDrawCallback': function() {
	    	           initialSearch();
	    	           initialTitle();
	    	      }
	    	});
		    
		    function initialSearch() {
		    	$('#searchAll').val(mainTable.search());
		    }
		    
		    function initialTitle() {
		    	$('#total-records').text(mainTable.page.info().recordsTotal);
		    }
		    
			function editForm(uuid) {
				$('#edit-form input[name="uuid"]').val(uuid);
				$('#edit-form').submit();
			}
			
			$('#length-change').change( function() { 
				mainTable.page.len( $(this).val() ).draw();
			});
			
			$('#mainTable').on('click', 'tbody tr', function() {
				//console.log('API row values : ', mainTable.row(this).data());
				var uuid = mainTable.row(this).data().uuid;
				editForm(uuid);
			});
			
			$(document).ready(function ()
		    {
			    mainTable.columns().every(function(index) {
			        $('#mainTable thead tr:eq(1) th:eq(' + index + ') input').on('keyup change', function() {
			            mainTable.column($(this).parent().index() + ':visible')
			                .search(this.value)
			                .draw();
			        });
			    });
			    
		    	$('#searchAll').keyup(function(){
					   mainTable.search( $(this).val() ).draw();
				});
		    });
		    /*]]>*/
		</script>
	</th:block>
</body>
</html>