<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout">
<body>
	<th:block layout:fragment="select (label,selectedTableId,selectedAttribute,attributeName,attributeObject,ajaxUrl,tableId,list,fields,localizedFields)">
		<div class="form-group">
			<label th:text="${label}"></label>
			<table class="table table-bordered table-hover" th:id="${selectedTableId}">
				<thead>
					<tr>
						<th:block th:if="${fields != null && localizedFields != null}">
							<th th:each="localizedField : ${localizedFields}" th:text="${localizedField}"></th>
						</th:block>
						<th:block th:if="${fields != null && localizedFields == null}">
							<th th:each="field : ${fields}" th:text="${field}"></th>
						</th:block>
						<th:block th:if="${fields == null}">
							<th style="width: 30%" th:text="#{module.common.id}"></th>
							<th th:text="#{module.common.name}"></th>
						</th:block>
						<th style="width: 1%"><button class="btn btn-default btn-sm" type="button" data-toggle="modal" th:data-target="'#modal'+${attributeName}">
								<i th:class="${list == true} ? 'fa fa-plus' : 'fa fa-edit'"></i>
							</button></th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="state : ${attributeObject}" th:id="${selectedTableId}+${state.uuid}">
						<th:block th:if="${fields != null}">
							<td th:each="field : ${fields}"><span th:text="${state.__${field}__}"></span></td>
						</th:block>
						<th:block th:if="${fields == null}">
							<td><span th:text="${state.id}"></span></td>
							<td><span th:text="${state.name}"></span></td>
						</th:block>
						<td>
							<button type="button" class="btn btn-default btn-sm" th:onclick="removeSelected([[${selectedTableId}]], [[${selectedAttribute}]], [[${state.uuid}]]);">
								<i class="fa fa-minus"></i>
							</button>
						</td>
					</tr>
				</tbody>
			</table>
			<span class="help-block"></span>
			<div th:id="${selectedAttribute}">
				<th:block th:each="state : ${attributeObject}">
					<input type="hidden" th:name="${selectedAttribute}" th:value="${state.uuid}" />
				</th:block>
			</div>
			<span class="help-block"></span>
			<div class="modal fade" th:id="'modal'+${attributeName}">
				<div class="modal-dialog modal-lg">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
							<h4 class="modal-title" th:text="${label}"></h4>
						</div>
						<div class="modal-body">
							<table th:id="${tableId}" class="table table-bordered table-hover" style="width: 100%">
								<thead>
									<tr>
										<th:block th:if="${fields != null && localizedFields != null}">
											<th th:each="localizedField : ${localizedFields}" th:text="${localizedField}"></th>
										</th:block>
										<th:block th:if="${fields != null && localizedFields == null}">
											<th th:each="field : ${fields}" th:text="${field}"></th>
										</th:block>
										<th:block th:if="${fields == null}">
											<th th:text="#{module.common.id}" class="text-center"></th>
											<th th:text="#{module.common.name}" class="text-center"></th>
										</th:block>
										<th th:text="#{module.common.select}" class="text-center"></th>
									</tr>
								</thead>
								<thead>
									<tr>
										<th:block th:if="${fields != null}">
											<th th:each="field : ${fields}"><input type="text" class="form-control" style="width: 100%;" /></th>
										</th:block>
										<th:block th:if="${fields == null}">
											<th><input type="text" class="form-control" style="width: 100%;" /></th>
											<th><input type="text" class="form-control" style="width: 100%;" /></th>
										</th:block>
										<th></th>
									</tr>
								</thead>
							</table>
							<script th:inline="javascript">
							    /*<![CDATA[*/
							    	
							    var locale = /*[[${#locale}]]*/;
							    
							    var ajaxUrl = /*[[${ajaxUrl}]]*/;
							    
							    var tableId = /*[[${tableId}]]*/;
							    
							    var radioGroup = /*[[${tableId}+${selectedAttribute}]]*/;
							    
							    $('#'+tableId).DataTable({
						    		  'language' : {
								        'url' : '/static/common/plugin/datatables/language/'+locale+'.json'
								      },
						    	      'pageLength'  : 10,
						    	      'paging'      : true,
						    	      'lengthChange': true,
						    	      'searching'   : true,
						    	      'ordering'    : true,
						    	      'info'        : true,
						    	      'autoWidth'   : true,
						    	      'processing': true,
						    	      'serverSide': true,
						    	      'searchDelay': 1000,
							    	  'bStateSave': false,
						    	      'dom': "<'row'<'col-sm-12 col-md-6'Bl><'col-sm-12 col-md-6'f>>" +
						    	      "<'row'<'col-sm-12'tr>>" +
						    	      "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>", 
						    	      'buttons': [
						                  {
						                      text: 'Clear', className: 'btn btn-primary btn-datatable', init: function(api, node, config) { $(node).removeClass('dt-button') },
						                      action: function ( e, dt, node, config ) {
						                    	  dt.search('').columns().search('').draw();dt.order.neutral().draw();
						                    	  $('#'+tableId).find("input:text").val("");
						                    	  $('#'+tableId).find("select").each(function () { // there is no such thing as input[type=select] 
						                    	        this.selectedIndex = 0; // this is a <select>
						                    	  });
						                    	  $('#'+tableId+' .select2').val('').trigger('change');
						                      }
						                  }
						              ],
						    	      'ajax': {
						                    'url': ajaxUrl
						              },
						              'columns': [
						            	    /*[# th:if="${fields != null}"]*/
						            	    /*[# th:each="field : ${fields}"]*/
						            	    { "data": /*[[${field}]]*/ },
						                    /*[/]*/
						                    /*[/]*/
						                    
						                    /*[# th:if="${fields == null}"]*/
						                    { "data": "id" },
						                    { "data": "name" },
						                    /*[/]*/
						                    
						                    { "data": "" }
						              ],
						    	      'columnDefs': [
						    	            { 
						    	            	/*[# th:if="${fields != null}"]*/
						    	            	targets: /*[[${#lists.size(fields)}]]*/,
						    	            	/*[/]*/
						    	            	
						    	            	/*[# th:if="${fields == null}"]*/
						    	                targets: 2,
						    	                /*[/]*/
						    	                'searchable': false,
						    	                'orderable': false,
						    	                'className': 'text-center',
						    	                render: function(data, type, row, meta)
						    	                {
						    	                	return "<input type='radio' value='"+JSON.stringify(row)+"' name='"+radioGroup+"'>"; 
						    	                }
						    	            },
							            	{                                 
							                	"targets": '_all',
							                	"className": 'select-filter',
							                	"render": $.fn.dataTable.render.text()
							                }              
						    	       ],
						    	       "drawCallback": function( settings ) {		    	            
						    	            // Apply the search
						    	           // this.api().columns('.select-filter').every( function (index) {
						    	                /* var that = this;
							    	            console.log(tableId);
						    	 					
						    	                $('#'+tableId+' thead tr:eq(1) th:eq(' + index + ') input').on('keyup change', function () {
						    	                	that.column($(this).parent().index() + ':visible')
									    	            .search(this.value)
									    	            .draw();
						    	                }); */
						    	            //});
						    	        }
						    	});
							    
							    $('#'+tableId).DataTable().columns('.select-filter').every( function (index) {
							        var that = this;
							        
							        $('#'+tableId+' thead tr:eq(1) th:eq(' + index + ') input').on('keyup change', function () {
			    	                	that.column($(this).parent().index() + ':visible')
						    	            .search(this.value)
						    	            .draw();
			    	                });
							     
							        /* $( 'input', this.footer() ).on( 'keyup change', function () {
							        	column($(this).parent().index() + ':visible')
					    	            .search(this.value)
					    	            .draw();
							        } ); */
							    } );
							    
							    $('.table').on('draw.dt', function () {
							    	$('input').iCheck({
										checkboxClass : 'icheckbox_square-blue',
										radioClass : 'iradio_square-blue',
										increaseArea : '20%' // optional
									});
							    });
							    /*]]>*/
							</script>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default pull-left" data-dismiss="modal" th:text="'  '+#{module.common.cancel}+'  '"></button>
							<th:block th:if="${list == null || list == false}">
								<button type="button" th:onclick="addSelect([[${selectedAttribute}]],[[${tableId}]],[[${selectedTableId}]],[[${fields}]])" class="btn btn-primary" data-dismiss="modal"
									th:text="'  '+#{module.common.select}+'  '"></button>
							</th:block>
							<th:block th:if="${list == true}">
								<button type="button" th:onclick="addSelects([[${selectedAttribute}]],[[${tableId}]],[[${selectedTableId}]],[[${fields}]])" class="btn btn-primary" data-dismiss="modal"
									th:text="'  '+#{module.common.select}+'  '"></button>
							</th:block>
						</div>
					</div>
					<!-- /.modal-content -->
				</div>
				<!-- /.modal-dialog -->
			</div>
		</div>
	</th:block>
</body>
</html>