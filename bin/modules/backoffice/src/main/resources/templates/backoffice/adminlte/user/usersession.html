<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" layout:decorate="~{core/adminlte/common/layout/layout}">
<head>
<title th:utext="#{module.user.session}"></title>
</head>
<body>
	<th:block layout:fragment="content">
		<section class="content">
			<div class="row">
				<div class="col-md-12">
					<div class="box box-solid">
						<!-- /.box-header -->
						<div class="">
							<div class="box-group" id="accordion">
								<!-- we are adding the .panel class so bootstrap.js collapse plugin detects it -->
								<div class="panel box box-primary">
									<div class="box-header with-border">
										<h4 class="box-title">
											<span th:class="@{${@environment.getProperty('module.user.session.icon')}}"></span>
											&nbsp;&nbsp;
											<span th:text="#{module.user.session}"></span>
										</h4>
									</div>
									<div id="collapseOne" th:class="'panel-collapse collapse in'">
										<div class="box-body">
											<div class="row">
												<div class="col-md-12">
													<div class="box box-solid">
														<div class="box-body bg-gray">
															<div class="row">
																<div class="col-xs-12" style="text-align: right">
																	<form role="form" th:action="@{${@environment.getProperty('path.user.session')}}" method="post">
																		<input type="hidden" name="deleteall">
																		<button type="submit" class="btn btn-danger" th:text="#{module.user.expireall}" sec:authorize="hasAuthority('usersession_delete')"></button>
																	</form>
																</div>
															</div>
														</div>
														<!-- /.box-header -->
													</div>
												</div>
											</div>
											<table id="usersessions" class="table table-bordered table-hover">
												<thead>
													<tr>
														<th th:text="#{module.user.id}"></th>
														<th th:text="#{module.user.session.id}"></th>
														<th th:text="#{module.user.session.lastrequest}"></th>
														<th width="1%" class="action" th:text="#{module.common.action}"></th>
													</tr>
												</thead>
												<tbody>
													<tr th:each="row : ${sessions}">
														<th scope="row">
															<a sec:authorize="hasAuthority('user_read')" th:href="@{${@environment.getProperty('path.user')}(uuid=${row.principaluser.uuid})}" th:text="${row.principaluser.id}"></a>
															<span sec:authorize="!hasAuthority('user_read')" th:text="${row.principaluser.id}"></span>
														</th>
														<td>
															<th:block th:each="row2 : ${row.sessionInformations}">
																<span th:text="${row2.sessionId}"></span>
															</th:block>
														</td>
														<td>
															<th:block th:each="row2 : ${row.sessionInformations}">
																<span th:text="${#dates.format(row2.lastRequest, 'yyyy-MM-dd, hh:mm:ss a')}"></span>
																<br>
															</th:block>
														</td>
														<td>
															<form role="form" th:action="@{${@environment.getProperty('path.user.session')}}" method="post">
																<input type="hidden" name="delete">
																<input type="hidden" name="uuid" th:value="${row.principaluser.uuid}">
																<button type="submit" class="btn btn-block btn-danger btn-sm" th:text="#{module.user.expirenow}"></button>
															</form>
														</td>
													</tr>
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!-- /.box-body -->
					</div>
				</div>
			</div>
		</section>
	</th:block>
	<th:block layout:fragment="js">
		<script th:inline="javascript">
			/*<![CDATA[*/
			
			var locale = /*[[${#locale}]]*/;
				
			$(function() {
			$("#usersessions").DataTable( {
		    	"language": {
		           	"decimal":        "",
		            "emptyTable":     /*[[#{module.common.datatable.emptyTable}]]*/,
		            "info":           /*[[#{module.common.datatable.info}]]*/,
		            "infoEmpty":      /*[[#{module.common.datatable.infoEmpty}]]*/,
		            "infoFiltered":   /*[[#{module.common.datatable.infoFiltered}]]*/,
		            "infoPostFix":    "",
		            "thousands":      ",",
		            "lengthMenu":     /*[[#{module.common.datatable.lengthMenu}]]*/,
		            "loadingRecords": /*[[#{module.common.datatable.loadingRecords}]]*/,
		            "processing":     /*[[#{module.common.datatable.processing}]]*/,
		            "search":         /*[[#{module.common.datatable.search}]]*/,
		            "zeroRecords":    /*[[#{module.common.datatable.zeroRecords}]]*/,
		            "paginate": {
		                "first":      /*[[#{module.common.datatable.paginate.first}]]*/,
		                "last":       /*[[#{module.common.datatable.paginate.last}]]*/,
		                "next":       /*[[#{module.common.datatable.paginate.next}]]*/,
		                "previous":   /*[[#{module.common.datatable.paginate.previous}]]*/
		            },
		            "aria": {
		                "sortAscending":  /*[[#{module.common.datatable.aria.sortAscending}]]*/,
		                "sortDescending": /*[[#{module.common.datatable.aria.sortDescending}]]*/
		            }		            
		        },
				"lengthMenu": [ [10, 25, 50, -1], [10, 25, 50, /*[[#{module.common.datatable.all}]]*/] ],
		    	"responsive" : true,
				'pageLength'  : 10,
	    	    'paging'      : true,
	    	    'lengthChange': true,
	    	    'searching'   : true,
	    	    'ordering'    : true,
	    	    'info'        : true,
	    	    'autoWidth'   : false,
	    	    'processing': false,
	    	    'serverSide': false,
		        'bStateSave': false,
		        'dom': 
	    	      "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" +
	    	      "<'row'<'col-sm-12'tr>>" +
	    	      "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>"
			});
			/*]]>*/
		</script>
	</th:block>
</body>
</html>