<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" layout:decorate="~{${@environment.getProperty('layout.console')}}">
<head>
<title th:utext="#{module.logging}"></title>
<!-- DataTables -->
<link rel="stylesheet" th:href="@{/static/adminlte/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css}">
<link rel="stylesheet" th:href="@{/static/adminlte/plugins/datatables-responsive/css/responsive.bootstrap4.min.css}">
<link rel="stylesheet" th:href="@{/static/adminlte/plugins/datatables-buttons/css/buttons.bootstrap4.min.css}">
</head>
<body>
	<th:block layout:fragment="content">
		<!-- Content Wrapper. Contains page content -->
		<div class="content-wrapper">

			<!-- Content Header (Page header) -->
			<div class="content-header">
				<div class="container-fluid">
					<div class="row mb-2">
						<div class="col-sm-6">
							<h1 class="m-0" th:text="#{module.logging}"></h1>
						</div>
						<!-- /.col -->
						<div class="col-sm-6">
							<ol class="breadcrumb float-sm-right">
								<li class="breadcrumb-item" th:text="#{module.console.platform}"></li>
								<li class="breadcrumb-item active" th:text="#{module.logging}"></li>
							</ol>
						</div>
						<!-- /.col -->
					</div>
					<!-- /.row -->
				</div>
				<!-- /.container-fluid -->
			</div>
			<!-- /.content-header -->

			<!-- Main content -->
			<section class="content">
				<div class="card">
					<!-- /.card-header -->
					<div class="card-body">
						<table id="loggersTable" class="table table-hover">
							<thead>
								<tr>
									<th th:text="#{module.logging.logger}"></th>
									<th th:text="#{module.logging.effectivelevel}" style="width:114px"></th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="logger : *{loggers.get('loggers')}">
									<td th:text="${logger.key}"></td>
									<td>
										<select class="form-control" th:id="${logger.key}">
											<option th:selected="${logger.value.effectiveLevel.toString() == level.toString()}" th:each="level : *{loggers.get('levels')}" th:text="${level}"></option>
										</select>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					<!-- /.card-body -->
				</div>
				<!-- /.card -->
			</section>
		</div>
	</th:block>
	<th:block layout:fragment="js">
		<script th:inline="javascript">
		    /*<![CDATA[*/
		    $(document).ready(function() {
		    	
		    var locale = /*[[${#locale}]]*/;
		    
			var pathSetLoggerLevel = /*[[@{${@environment.getProperty('path.api.application.setloggerlevel')}}]]*/;
		    	
		    $('#loggersTable').DataTable({
	    	      'pageLength'  : 10,
	    	      'paging'      : true,
	    	      'lengthChange': true,
	    	      'searching'   : true,
	    	      'ordering'    : true,
	    	      'info'        : true,
	    	      'autoWidth'   : true
	    	})
	    	
	    	$('#loggersTable select').change(function(){
	    		var opt = $(this).find('option:selected');
	    		
	    	    var id = $(this).attr('id');
	    		var val = $(this).val();
	    	    
	    	    $.ajax({
	    	        method: "GET",
	    	        url: pathSetLoggerLevel,
	    	        data: {name:id, level:val},
	    	        cache: false
	    	    }).done(function(response){
	    	        console.log(response);
	    	    });
	    	});
	    	
		    });
		    /*]]>*/
		</script>
	</th:block>
</body>
</html>
