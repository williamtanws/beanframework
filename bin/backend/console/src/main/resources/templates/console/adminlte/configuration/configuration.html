<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" layout:decorate="~{${@environment.getProperty('layout.console')}}">
<head>
<title th:utext="#{module.configuration}"></title>

<!-- DataTables -->
<link rel="stylesheet" th:href="@{/static/adminlte/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css}">
<link rel="stylesheet" th:href="@{/static/adminlte/plugins/datatables-responsive/css/responsive.bootstrap4.min.css}">
<link rel="stylesheet" th:href="@{/static/adminlte/plugins/datatables-buttons/css/buttons.bootstrap4.min.css}">

</head>
<body>
	<th:block layout:fragment="content">
		<!-- Content Wrapper. Contains page content -->
		<div class="content-wrapper">

			<!-- Content Header (Page header) -->
			<div class="content-header">
				<div class="container-fluid">
					<div class="row mb-2">
						<div class="col-sm-6">
							<h1 class="m-0" th:text="#{module.configuration}"></h1>
						</div>
						<!-- /.col -->
						<div class="col-sm-6">
							<ol class="breadcrumb float-sm-right">
								<li class="breadcrumb-item" th:text="#{module.console.platform}"></li>
								<li class="breadcrumb-item active" th:text="#{module.configuration}"></li>
							</ol>
						</div>
						<!-- /.col -->
					</div>
					<!-- /.row -->
				</div>
				<!-- /.container-fluid -->
			</div>
			<!-- /.content-header -->

			<!-- Main content -->
			<section class="content">
				<div class="card">
					<!-- /.card-header -->
					<div class="card-body">
						<table id="mainDataTable" class="table table-bordered table-striped">
							<thead>
								<tr>
									<th>ID</th>
									<th>Value</th>
									<th>Action</th>
								</tr>
							</thead>
						</table>
					</div>
					<!-- /.card-body -->
				</div>
				<!-- /.card -->
			</section>
		</div>

		<div class="modal fade" id="modal-form">
			<div class="modal-dialog modal-xl">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="btn btn-danger"><i class="fas fa-trash-alt"></i></button>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
						<iframe src="" id="model-form-iframe" style="border: none; width: 100%; height: 100%; min-height: 280px"></iframe>
					</div>
					<div class="modal-footer justify-content-between">
						<button type="button" class="btn btn-default" data-dismiss="modal" th:text="#{module.common.close}"></button>
						<button type="button" class="btn btn-primary" th:text="#{module.common.save}" onclick="saveItem()"></button>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal-dialog -->
		</div>
		<!-- /.modal -->

	</th:block>
	<th:block layout:fragment="js">
		<!-- DataTables  & Plugins -->
		<script th:src="@{/static/adminlte/plugins/datatables/jquery.dataTables.min.js}"></script>
		<script th:src="@{/static/adminlte/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js}"></script>
		<script th:src="@{/static/adminlte/plugins/datatables-responsive/js/dataTables.responsive.min.js}"></script>
		<script th:src="@{/static/adminlte/plugins/datatables-responsive/js/responsive.bootstrap4.min.js}"></script>
		<script th:src="@{/static/adminlte/plugins/datatables-buttons/js/dataTables.buttons.min.js}"></script>
		<script th:src="@{/static/adminlte/plugins/datatables-buttons/js/buttons.bootstrap4.min.js}"></script>
		<script th:src="@{/static/adminlte/plugins/jszip/jszip.min.js}"></script>
		<script th:src="@{/static/adminlte/plugins/pdfmake/pdfmake.min.js}"></script>
		<script th:src="@{/static/adminlte/plugins/pdfmake/vfs_fonts.js}"></script>
		<script th:src="@{/static/adminlte/plugins/datatables-buttons/js/buttons.html5.min.js}"></script>
		<script th:src="@{/static/adminlte/plugins/datatables-buttons/js/buttons.print.min.js}"></script>
		<script th:src="@{/static/adminlte/plugins/datatables-buttons/js/buttons.colVis.min.js}"></script>

		<script th:inline="javascript">
		/*<![CDATA[*/
			
		$('#modal-form').on('hidden.bs.modal', function () {
			$('#mainDataTable').DataTable().ajax.reload(null, false);
		})
			
		function addItem(){
			var url = /*[[@{${@environment.getProperty('path.configuration')}}]]*/;
			url = url + "?create";
			$("#model-form-iframe").attr('src', url);					
	    	$('#modal-form').modal('show');
		}
			
		function editItem(uuid){
			var url = /*[[@{${@environment.getProperty('path.configuration')}}]]*/;
			url = url + "?uuid="+uuid;
			$("#model-form-iframe").attr('src', url);		
	    	$('#modal-form').modal('show');
		}
		
		function saveItem(){
			$("#model-form-iframe").contents().find('form')[0].submit();
		}
		
		function deleteItem(){
			$("#model-form-iframe").contents().find('form')[0].submit();
		}
		
		$(document).ready(function() {

		    $('#mainDataTable').DataTable( {
		    	"lengthMenu": [ [10, 25, 50, -1], [10, 25, 50, "All"] ],
		    	"responsive" : true,
				'pageLength'  : 10,
	    	    'paging'      : true,
	    	    'lengthChange': true,
	    	    'searching'   : true,
	    	    'ordering'    : true,
	    	    'info'        : true,
	    	    'autoWidth'   : false,
	    	    'processing': true,
	    	    'serverSide': true,
	    	    'searchDelay': 1000,
		        'bStateSave': true,
				'ajax': {
                    'url': /*[[@{${@environment.getProperty('path.api.configuration.page')}}]]*/,
                    'cache': false,
                    'async': false
                 },
		        "columns": [
		            { "data": "id" },
		            { "data": "value" },
		            { "data": "uuid" }
		        ],
		        "columnDefs": [
		        	{
		          		"targets": -1,
		         		'orderable': false,
		         		'visible': false,
		         		render: function(data, type, row, meta)
    	                {
    	                	return "<button type='button' class='btn btn-default' onclick=\"editItem('"+row.uuid+"')\">Edit</button>"; 
    	                }
		        	}
		        
		        ],
		        "buttons": [
		        	{
		                text: 'Add',
		                action: function ( e, dt, node, config ) {
		                    addItem();
		                }
		            },
		            {
		                extend: 'csv',
		                text: 'Export CSV',
		                className: 'btn btn-default',
		                exportOptions: {
		                   columns: 'th:not(:last-child)'
		                }
		            },
		            {
		                extend: 'excel',
		                text: 'Export Excel',
		                className: 'btn btn-default',
		                exportOptions: {
		                   columns: 'th:not(:last-child)'
		                }
		            },
		            {
		                extend: 'pdf',
		                text: 'Export PDF',
		                className: 'btn btn-default',
		                exportOptions: {
		                   columns: 'th:not(:last-child)'
		                }
		            },
		            {
		                extend: 'print',
		                text: 'Print',
		                className: 'btn btn-default',
		                exportOptions: {
		                   columns: 'th:not(:last-child)'
		                }
		            },
		            {
		                extend: 'colvis',
		                text: 'Visibility',
		                className: 'btn btn-default',
		                exportOptions: {
		                   columns: 'th:not(:last-child)'
		                }
		            }
		    	]
		    }).buttons().container().appendTo('#mainDataTable_wrapper .col-md-6:eq(0)');
		});
		
		/*]]>*/
		</script>
	</th:block>
</body>
</html>