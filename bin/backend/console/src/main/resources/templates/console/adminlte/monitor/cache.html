<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
	layout:decorate="~{${@environment.getProperty('layout.console')}}">
<head>
<title th:utext="#{module.console.cache}"></title>
</head>
<body>
	<th:block layout:fragment="content">
		<section class="content">
			<div class="row">
				<th:block layout:insert="~{/console/adminlte/common/component/alert :: custom}"></th:block>
			</div>
			<div class="row">
				<div class="col-md-12">
					<div class="box box-solid">
						<div class="box-group" id="accordion">
							<!-- we are adding the .panel class so bootstrap.js collapse plugin detects it -->
							<div class="panel box box-primary">
								<div class="box-header with-border">
									<h4 class="box-title">
										<span th:class="@{${@environment.getProperty('module.cache.icon')}}"></span>
										&nbsp;&nbsp;
										<span th:text="#{module.cache}+' ('+${caches.size()}+')'"></span>
									</h4>
								</div>
								<div class="box-body">
									<div class="row">
										<div class="col-md-12">
											<div class="box box-solid">
												<div class="box-body bg-gray">
													<div class="row">
														<div class="col-xs-4">
															<form method="post" th:action="@{${@environment.getProperty('path.cache.clearall')}}">
																<input type="hidden" name="clearall" />
																<button type="submit" class="btn btn-danger">
																	<span class="fa fa-trash" th:text="' '+#{module.cache.clearall}"></span>
																</button>
															</form>
														</div>
													</div>
												</div>
												<!-- /.box-header -->
											</div>
										</div>
										<div class="col-md-12">
											<div class="dataTables_wrapper form-inline dt-bootstrap">
												<table id="cacheTable" class="table table-bordered table-striped">
													<thead>
														<tr>
															<th th:text="#{module.cache.name}"></th>
															<th th:text="#{module.cache.entry.total}"></th>
															<th th:text="#{module.cache.local.heap.entry}"></th>
															<th th:text="#{module.cache.local.heap.size}"></th>
															<th th:text="#{module.cache.local.offheap.entry}"></th>
															<th th:text="#{module.cache.local.offheap.size}"></th>
															<th th:text="#{module.cache.local.disk.entry}"></th>
															<th th:text="#{module.cache.local.disk.size}"></th>
														</tr>
													</thead>
													<tbody>
														<tr th:each="row : ${caches}">
															<td th:text="${row.name}" style="word-wrap: break-word; max-width: 650px;"></td>
															<td th:text="${row.getStatistics().getSize()}"></td>
															<td th:text="${row.getStatistics().getLocalHeapSize()}"></td>
															<td class="readableBytes" th:text="${row.getStatistics().getLocalHeapSizeInBytes()}"></td>
															<td th:text="${row.getStatistics().getLocalOffHeapSize()}"></td>
															<td class="readableBytes" th:text="${row.getStatistics().getLocalOffHeapSizeInBytes()}"></td>
															<td th:text="${row.getStatistics().getLocalDiskSize()}"></td>
															<td class="readableBytes" th:text="${row.getStatistics().getLocalDiskSizeInBytes()}"></td>
														</tr>
													</tbody>
												</table>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
		<script th:inline="javascript">
			/*<![CDATA[*/

			$('#cacheTable').DataTable({
				'pageLength' : 10,
				'paging' : true,
				'lengthChange' : false,
				'searching' : true,
				'ordering' : true,
				'info' : false,
				'autoWidth' : true
			})

			$('#cacheTable').on('draw.dt', function() {
				$(".readableBytes").each(function() {
					var text = $(this).text();
					if ($.isNumeric(text)) {
						$(this).text(readableBytes(text));
					}
				});
			});

			$(".readableBytes").each(function() {
				var text = $(this).text();
				if ($.isNumeric(text)) {
					$(this).text(readableBytes(text));
				}
			});

			function readableBytes(bytes) {
				if (bytes == 0) {
					return '0 B';
				}
				var i = Math.floor(Math.log(bytes) / Math.log(1024)), sizes = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB' ];

				return (bytes / Math.pow(1024, i)).toFixed(2) * 1 + ' '
						+ sizes[i];
			}
			/*]]>*/
		</script>
	</th:block>
</body>
</html>
