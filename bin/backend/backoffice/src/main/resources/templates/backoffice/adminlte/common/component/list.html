<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout">
<body>
	<th:block layout:fragment="list (title, objectUpdate, objectSearch, icon, createAuthority, updateAuthority, listFields, paginationAction, searchFields, updateForm)">
		<div class="col-md-12">
			<div class="box box-solid">
				<!-- /.box-header -->
				<div class="box-group" id="accordion">
					<!-- we are adding the .panel class so bootstrap.js collapse plugin detects it -->
					<div class="panel box box-primary">
						<div class="box-header with-border">
							<h4 class="box-title">
								<a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" th:aria-expanded="${objectUpdate.uuid == null ? 'true':'false'}" th:class="${objectUpdate.uuid == null ? '':'collapsed'}">
									<span th:class="${icon}"></span>
									&nbsp;&nbsp;
									<span th:text="${title}+' ('+${pagination.getTotalElements()}+')'"></span>
									<i class="fa fa-fw fa-angle-double-down"></i>
								</a>
							</h4>
						</div>
						<div id="collapseOne" th:class="'panel-collapse collapse '+${objectUpdate.uuid == null ? 'in':''}">
							<div class="box-body">
								<div class="row">
									<div class="col-md-12">
										<div class="box box-solid">
											<div class="box-body bg-gray">
												<div class="row">
													<div class="col-xs-4">
														<button type="button" class="btn btn-default" data-toggle="modal" data-target="#modal-create" th:if="${#authorization.expression('hasAuthority('''+createAuthority+''')')}">
															<span class="fa fa-plus color"></span>
														</button>
													</div>
													<div class="col-xs-8" style="text-align: right">
														<th:block layout:insert="/backoffice/adminlte/common/fragment/pagination :: button"></th:block>
													</div>
												</div>
											</div>
											<!-- /.box-header -->
										</div>
									</div>
									<div class="col-md-12">
										<div class="dataTables_wrapper form-inline dt-bootstrap">
											<table class="table table-bordered table-hover dataTable">
												<thead>
													<tr role="row">
														<th class="sorting" id="id"
															th:class="${pagination.getSort().getOrderFor('id') != null}? sorting_+${pagination.getSort().getOrderFor('id').getDirection().toString().toLowerCase()} : sorting"
															th:text="#{module.backoffice.id}"></th>

														<th class="sorting" th:each="field : ${listFields}" th:id="${field[0]}"
															th:class="${pagination.getSort().getOrderFor(field[0]) != null}? sorting_+${pagination.getSort().getOrderFor(field[0]).getDirection().toString().toLowerCase()} : sorting"
															th:text="${field[1]}"></th>
													</tr>
												</thead>
												<tbody>
													<th:block th:each="row : ${pagination.content}">
														<th:block th:if="${#authorization.expression('hasAuthority('''+updateAuthority+''')')}">
															<tr th:onclick="getForm([[${row.uuid}]])">
																<th scope="row" th:text="${row.id}"></th>
																<td scope="row" th:each="field : ${listFields}" th:text="${#strings.abbreviate(row.__${field[0]}__,50)}"></td>
															</tr>
														</th:block>
														<th:block th:if="!${#authorization.expression('hasAuthority('''+updateAuthority+''')')}">
															<tr>
																<th scope="row" th:text="${row.id}"></th>
																<td scope="row" th:each="field : ${listFields}" th:text="${#strings.abbreviate(row.__${field[0]}__,50)}"></td>
															</tr>
														</th:block>
													</th:block>
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="panel box box-success" th:if="${ objectUpdate.uuid != null and #authorization.expression('hasAuthority('''+updateAuthority+''')') }">
						<div class="box-header with-border">
							<h4 class="box-title">
								<a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" th:aria-expanded="${objectUpdate.uuid == null ? 'false':'true'}" th:class="${objectUpdate.uuid == null ? 'collapsed':''}">
									<span th:text="'ID: '+${objectUpdate.id}"></span>
									<i class="fa fa-fw fa-angle-double-down"></i>
								</a>
							</h4>
						</div>
						<div id="collapseTwo" th:class="'panel-collapse collapse '+${objectUpdate.uuid == null ? '':'in'}">
							<div class="box-body">
								<th:block layout:insert="${updateForm} :: update" th:if="${objectUpdate.uuid != null}"></th:block>
							</div>
						</div>
					</div>
				</div>
				<!-- /.box-body -->
			</div>
		</div>
		<form id="pagination-sort-form" th:action="${paginationAction}" method="get" th:object="${objectSearch}" style="display: none">
			<input type="hidden" name="page" th:value="${pagination.getNumber()+1}">
			<input type="hidden" name="size" th:value="${pagination.getSize()}">
			<input type="hidden" name="direction" th:value="${direction}">
			<input type="hidden" name="properties" th:value="${properties}">
			<input type="hidden" name="searchAll" th:value="${objectSearch.searchAll}" class="form-control">
			<input type="hidden" th:each="field : ${searchFields}" th:name="${field}" th:value="${objectSearch.__${field}__}" class="form-control">
		</form>
		<form id="get-form" th:action="${paginationAction}+'#tab_general'" method="get" th:object="${objectSearch}" style="display: none">
			<input type="hidden" name="page" th:value="${pagination.getNumber()+1}">
			<input type="hidden" name="size" th:value="${pagination.getSize()}">
			<input type="hidden" name="direction" th:value="${direction}">
			<input type="hidden" name="properties" th:value="${properties}">
			<input type="hidden" name="uuid">
			<input type="hidden" name="searchAll" th:value="${objectSearch.searchAll}" class="form-control">
			<input type="hidden" th:each="field : ${searchFields}" th:name="${field}" th:value="${objectSearch.__${field}__}" class="form-control">
		</form>
		<form id="pagination-form" th:action="${paginationAction}" method="get" th:object="${objectSearch}" style="display: none">
			<input type="hidden" name="page">
			<input type="hidden" name="size" th:value="${pagination.getSize()}">
			<input type="hidden" name="direction" th:value="${direction}">
			<input type="hidden" name="properties" th:value="${properties}">
			<input type="hidden" name="searchAll" th:value="${objectSearch.searchAll}" class="form-control">
			<input type="hidden" th:each="field : ${searchFields}" th:name="${field}" th:value="${objectSearch.__${field}__}" class="form-control">
		</form>
		<th:block layout:insert="/backoffice/adminlte/common/component/list :: js"></th:block>
	</th:block>

	<th:block layout:fragment="js">
		<script th:inline="javascript">
			/*<![CDATA[*/
			$('.table .sorting, .table .sorting_asc, .table .sorting_desc').on(
					'click',
					function(e) {
						var theClass = this.className; // "this" is the element clicked
						var theId = e.target.id;

						$('#pagination-sort-form input[name=properties]').val(
								theId);

						if (theClass == 'sorting') {
							$('#pagination-sort-form input[name=direction]')
									.val('asc');
						} else if (theClass == 'sorting_asc') {
							$('#pagination-sort-form input[name=direction]')
									.val('desc');
						} else if (theClass == 'sorting_desc') {
							$('#pagination-sort-form input[name=properties]')
									.val('');
							$('#pagination-sort-form input[name=direction]')
									.val('');
						}

						$("#pagination-sort-form").submit();
					});

			function getPage(page) {
				$('#pagination-form input[name="page"]').val(page);
				$('#pagination-form').submit();
			}

			function getForm(uuid) {
				$('#get-form input[name="uuid"]').val(uuid);
				$('#get-form').submit();
			}
			/*]]>*/
		</script>
	</th:block>
</body>
</html>