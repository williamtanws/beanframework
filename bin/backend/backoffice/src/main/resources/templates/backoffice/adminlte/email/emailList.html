<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
	layout:decorate="~{${@environment.getProperty('layout.backoffice')}}">
<head>
<title th:utext="#{module.email}"></title>
</head>
<body>
	<th:block layout:fragment="content">
		<section class="content">
			<!-- Search Form-->
			<div class="row">
				<th:block
					layout:insert="~{/backoffice/adminlte/common/component/search :: search (searchAction=@{${@environment.getProperty('path.email')}}, objectSearch=${emailSearch}, searchFields=${ {'name','subject'} }, displayFields=${ {'name','subject'} } )}"></th:block>
			</div>
			<!-- Alert Notification-->
			<div class="row">
				<th:block layout:insert="~{/backoffice/adminlte/common/component/alert :: custom}"></th:block>
			</div>
			<!-- List Table-->
			<div class="row" th:with="emailName=#{module.email.name}, emailSubject=#{module.email.subject}">
				<th:block
					layout:insert="~{/backoffice/adminlte/common/component/list :: list (title=#{module.email}, objectUpdate=${emailUpdate}, objectSearch=${emailSearch}, icon=@{${@environment.getProperty('module.email.icon')}}, createAuthority='email_create', updateAuthority='email_update', listFields=${ {{'name', emailName},{'subject', emailSubject}} }, paginationAction=@{${@environment.getProperty('path.email')}}, searchFields=${ {'name','subject'} }, updateForm='/backoffice/adminlte/email/emailForm')}"></th:block>
			</div>
			<!-- Create Modal-->
			<th:block sec:authorize="hasAuthority('email_create')"
				layout:insert="~{/backoffice/adminlte/email/emailList :: create (createAction=@{${@environment.getProperty('path.email')}}, createObject=${emailCreate}, createForm='/backoffice/adminlte/common/component/general', createCheckId=${@environment.getProperty('path.api.email.checkid')})}"></th:block>
		</section>
	</th:block>
	<th:block layout:fragment="create (createAction, createObject, createForm, createCheckId)">
		<div class="modal fade" id="modal-create">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title" th:text="#{module.backoffice.record.new}"></h4>
					</div>
					<form id="create-form" role="form" th:action="${createAction}" method="post" th:object="${createObject}">
						<input type="hidden" name="create">
						<input type="hidden" name="page" th:value="${pagination.getNumber()+1}">
						<input type="hidden" name="size" th:value="${pagination.getSize()}">
						<input type="hidden" name="direction" th:value="${direction}">
						<input type="hidden" name="properties" th:value="${properties}">
						<div class="modal-body">
							<div class="container-fluid">
								<div class="row">
									<div class="col-md-6">
										<div class="form-group">
											<label for="name" th:text="#{module.email.name} + ' *'"></label>
											<input type="text" class="form-control" name="name">
											<span class="help-block"></span>
										</div>
									</div>
								</div>
								<th:block layout:insert="~{${createForm} :: create}"></th:block>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default pull-left" data-dismiss="modal" th:text="'  '+#{module.backoffice.cancel}+'  '"></button>
							<button type="submit" class="btn btn-success" th:text="#{module.backoffice.save}"></button>
						</div>
					</form>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal-dialog -->
		</div>
		<script th:inline="javascript">
		    /*<![CDATA[*/
		    $(document).ready(function() {
		        $('#create-form').validate({
		        	onfocusout: false,
		            invalidHandler: function(form, validator) {
		                var errors = validator.numberOfInvalids();
		                if (errors) {                    
		                    validator.errorList[0].element.focus();
		                }
		            },
		            rules: {
		            	name: {
		                    required: true
		                }
		            },
		            messages: {
		            	name: {
		                    required: /*[[#{module.email.name.required}]]*/
		                }
		            },
		            highlight: function(element) {
		                $(element).closest('.form-group').addClass('has-error');
		            },
		            errorPlacement: function(error, element) {
		                element.closest('.form-group').find('.help-block').html(error.text());
		            }
		        });
		
		    });
		    /*]]>*/
		</script>
	</th:block>
</body>
</html>