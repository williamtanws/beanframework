<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
	layout:decorate="${@environment.getProperty('layout.backoffice')}">
<head>
<title th:text="#{module.usergroup}"></title>
</head>
<body>
	<th:block layout:fragment="general">
		<div class="col-md-6">
			<div class="form-group">
				<label for="id" th:text="#{module.usergroup.id}"></label>
				<input type="text" class="form-control" name="id" th:value="*{id}">
				<span class="help-block"></span>
			</div>
		</div>
	</th:block>
	<th:block layout:fragment="attribute">
		<div class="col-md-6">
			<div class="form-group" th:each="langActive : ${moduleLanguages}" th:if="*{uuid != null}">
				<th:block th:each="field,itrStat : *{userGroupFields}" th:if="${field.dynamicField.language.id == langActive.id}">
					<label for="name" th:text="${field.dynamicField.name}+'('+${field.dynamicField.language.id}+')'"></label>
					<input type="hidden" th:name="'userGroupFields['+${itrStat.index}+'].uuid'" th:value="${field.uuid}">
					<input type="text" class="form-control" th:name="'userGroupFields['+${itrStat.index}+'].value'" th:value="${field.value}" th:required="${field.dynamicField.required}">
				</th:block>
				<span class="help-block"></span>
			</div>
			<div class="form-group" th:each="langActive,itrStat : ${moduleLanguages}" th:if="*{uuid == null}">
				<label for="name" th:text="#{module.userGroup.name}+'('+${langActive.id}+')'"></label>
				<input type="hidden" th:name="'userGroupFields['+${itrStat.index}+'].language.uuid'" th:value="${langActive.uuid}">
				<input type="text" class="form-control" th:name="'userGroupFields['+${itrStat.index}+'].name'">
				<span class="help-block"></span>
			</div>
		</div>
	</th:block>
	<th:block layout:fragment="usergroup">
		<table id="usergroupTable" class="table table-bordered table-hover">
			<thead>
				<tr>
					<th th:text="#{module.usergroup.id}"></th>
					<th th:text="#{module.backoffice.select}"></th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="userGroup,itrStat : *{userGroups}">
					<th:block th:each="userGroupField : ${userGroup.userGroupFields}">
						<td th:if="(${userGroupField.dynamicField.language.id == #locale.toString()})" th:text="${userGroupField.value}"></td>
					</th:block>
					<td>
						<input type="hidden" th:name="'userGroups['+${itrStat.index}+'].uuid'" th:value="${userGroup.uuid}">
						<input type="checkbox" th:name="'userGroups['+${itrStat.index}+'].selected'" th:checked="${userGroup.selected}">
						<script th:inline="javascript">
							$('input').iCheck({
						      checkboxClass: 'icheckbox_square-blue',
						      radioClass: 'iradio_square-blue',
						      increaseArea: '20%' // optional
						    });
						</script>
					</td>
				</tr>
			</tbody>
		</table>
	</th:block>
	<th:block layout:fragment="userauthority">
		<table class="table table-bordered">
			<tbody>
				<tr>
					<th th:text="#{module.userpermission}"></th>
					
					<th th:each="userRight: ${userRights}">
						<th:block th:each="field : ${userRight.userRightFields}">
							<span th:if="(${field.dynamicField.language.id == #locale.toString() and field.dynamicField.name == 'Name'})" th:text="${field.value}"></span>
						</th:block>
					</th>
				</tr>
				<tr th:each="userPermission: ${userPermissions}">
					<th:block th:each="field : ${userPermission.userPermissionFields}">
						<th th:if="(${field.dynamicField.language.id == #locale.toString()})" th:text="${field.value}"></th>
					</th:block>
					<td th:each="userRight: ${userRights}">
						<th:block th:each="userAuthority,itrStat : *{userAuthorities}">
							<th:block th:if="${userAuthority.userRight.uuid == userRight.uuid && userAuthority.userPermission.uuid == userPermission.uuid}">
								<input type="hidden" th:name="'userAuthorities['+${itrStat.index}+'].uuid'"  th:value="${userAuthority.uuid}">
								<input type="hidden" th:name="'userAuthorities['+${itrStat.index}+'].id'"  th:value="*{id}+'_'+${userAuthority.userPermission.id + '_' + userAuthority.userRight.id }">
								<input type="hidden" th:name="'userAuthorities['+${itrStat.index}+'].userGroup.uuid'"  th:value="*{uuid}">
								<input type="hidden" th:name="'userAuthorities['+${itrStat.index}+'].userPermission.uuid'"  th:value="${userAuthority.userPermission.uuid}">
								<input type="hidden" th:name="'userAuthorities['+${itrStat.index}+'].userRight.uuid'"  th:value="${userAuthority.userRight.uuid}">
								<input type="checkbox" th:name="'userAuthorities['+${itrStat.index}+'].enabled'" th:checked="${userAuthority.enabled}">
							</th:block>
						</th:block>
					</td>
				</tr>
			</tbody>
		</table>
	</th:block>
	<th:block layout:fragment="administration">
		<div class="col-md-6">
			<div class="form-group">
				<label th:text="#{module.backoffice.uuid} + ':'"></label>
				<span class="text-block" th:text="*{uuid}"></span>
			</div>
			<div class="form-group">
				<label th:text="#{module.backoffice.lastmodified.date} + ':'"></label>
				<span class="text-block" th:text="*{lastModifiedDate != null} ? *{#dates.format(lastModifiedDate, ' dd MMMM yyyy hh:mma')}"></span>
			</div>
			<div class="form-group" sec:authorize="hasAuthority('employee_read')">
				<label th:text="#{module.backoffice.lastmodified.by} + ':'"></label>
				<a th:href="@{${@environment.getProperty('path.employee')}(uuid=*{lastModifiedBy})}+'#tab_general'" th:text="#{module.backoffice.find.user}" th:if="*{lastModifiedBy != null}"></a>
			</div>
		</div>
		<div class="col-md-6">
			<div class="form-group">
				<label th:text="#{module.backoffice.created.date} + ':'"></label>
				<span class="text-block" th:text="*{createdDate != null} ? *{#dates.format(createdDate, ' dd MMMM yyyy hh:mma')}"></span>
			</div>
			<div class="form-group" sec:authorize="hasAuthority('employee_read')">
				<label th:text="#{module.backoffice.created.by} + ':'"></label>
				<a th:href="@{${@environment.getProperty('path.employee')}(uuid=*{createdBy})}+'#tab_general'" th:text="#{module.backoffice.find.user}" th:if="*{createdBy != null}"></a>
			</div>
		</div>
	</th:block>
	<th:block layout:fragment="create">
		<div class="modal fade" id="modal-create" sec:authorize="hasAuthority('usergroup_create')">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title" th:text="#{module.backoffice.record.new}"></h4>
					</div>
					<form id="usergroup-create-form" role="form" th:action="@{${@environment.getProperty('path.usergroup')}}" method="post" th:object="${usergroupCreate}">
						<input type="hidden" name="create">
						<input type="hidden" name="page" th:value="${pagination.getNumber()+1}">
						<input type="hidden" name="size" th:value="${pagination.getSize()}">
						<input type="hidden" name="direction" th:value="${direction}">
						<input type="hidden" name="properties" th:value="${properties}">
						<input type="hidden" th:value="${usergroupSearch.idSearch}" name="idSearch">
						<div class="modal-body">
							<div class="container-fluid">
								<div class="row">
									<th:block layout:insert="/backoffice/adminlte/user/usergroupForm :: general"></th:block>
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default pull-left" data-dismiss="modal" th:text="'  '+#{module.backoffice.cancel}+'  '"></button>
							<button type="submit" class="btn btn-success" th:text="#{module.backoffice.save}"></button>
						</div>
					</form>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal-dialog -->
		</div>
		<script th:inline="javascript">
		    /*<![CDATA[*/
		    $(document).ready(function() {
		        $('#usergroup-create-form').validate({
		            rules: {
		                id: {
		                    required: true,
		                    remote: {
		                        url: /*[[${@environment.getProperty('path.api.usergroup.checkid')}]]*/ ,
		                        type: "get",
		                        data: {
		                            uuid: '' ,
		                            id: function() {
		                                return $("#usergroup-create-form input[name='id']").val();
		                            }
		                        }
		                    }
		                },
		                name: {
		                    required: true
		                }
		            },
		            messages: {
		                id: {
		                    required: /*[[#{module.usergroup.id.required}]]*/ ,
		                    remote: /*[[#{module.usergroup.id.exists}]]*/
		                }
		            },
		            highlight: function(element) {
		                $(element).closest('.form-group').addClass('has-error');
		            },
		            unhighlight: function(element) {
		                $(element).closest('.form-group').removeClass('has-error');
		                $(element).closest('.form-group').find('.help-block').html('');
		            },
		            errorPlacement: function(error, element) {
		                element.closest('.form-group').find('.help-block').html(error.text());
		            }
		        });
		    });
		    /*]]>*/
		</script>
	</th:block>
	<th:block layout:fragment="update">
		<form id="usergroup-update-form" role="form" th:action="${@environment.getProperty('path.usergroup')}" method="post" th:object="${usergroupUpdate}">
			<input type="hidden" name="update">
			<input type="hidden" name="uuid" th:value="${usergroupUpdate.uuid}" />
			<input type="hidden" name="page" th:value="${pagination.getNumber()+1}">
			<input type="hidden" name="size" th:value="${pagination.getSize()}">
			<input type="hidden" name="direction" th:value="${direction}">
			<input type="hidden" name="properties" th:value="${properties}">
			<input type="hidden" th:value="${usergroupSearch.idSearch}" name="idSearch">
			<div class="row">
				<div class="col-md-12">
					<div class="box box-solid">
						<div class="box-body bg-gray">
							<div class="row">
								<div class="col-xs-4 col-sm-6 col-md-6 col-lg-6">
									<button type="button" class="btn btn-danger" data-toggle="modal" data-target="#modal-delete" sec:authorize="hasAuthority('usergroup_delete')">
										<i class="fa fa-trash"></i>
									</button>
								</div>
								<div class="col-xs-8 col-sm-6 col-md-6 col-lg-6" style="text-align: right">
									<a class="btn btn-default" th:text="#{module.backoffice.refresh}" onclick="window.location.reload()"></a>
									<button type="submit" class="btn btn-success" th:text="#{module.backoffice.save}" sec:authorize="hasAuthority('usergroup_update')"></button>
								</div>
							</div>
						</div>
						<!-- /.box-header -->
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<!-- Custom Tabs -->
					<div class="nav-tabs-custom">
						<ul class="nav nav-tabs">
							<li class="active">
								<a href="#tab_general" data-toggle="tab" th:text="#{module.backoffice.general}" onclick="changeTab('general')"></a>
							</li>
							<li>
								<a href="#tab_attribute" data-toggle="tab" th:text="#{module.backoffice.attribute}" onclick="changeTab('attribute')"></a>
							</li>
							<li>
								<a href="#tab_usergroup" data-toggle="tab" th:text="#{module.usergroup}" onclick="changeTab('usergroup')"></a>
							</li>
							<li>
								<a href="#tab_userauthority" data-toggle="tab" th:text="#{module.userauthority}" onclick="changeTab('userauthority')"></a>
							</li>
							<li>
								<a href="#tab_administration" data-toggle="tab" th:text="#{module.backoffice.administration}" onclick="changeTab('administration')"></a>
							</li>
						</ul>
						<div class="tab-content">
							<div class="tab-pane active" id="tab_general">
								<div class="box-body">
									<th:block layout:insert="/backoffice/adminlte/user/usergroupForm :: general"></th:block>
								</div>
								<!-- /.box-body -->
							</div>
							<!-- /.tab-pane -->
							<div class="tab-pane" id="tab_attribute">
								<div class="box-body">
									<th:block layout:insert="/backoffice/adminlte/user/usergroupForm :: attribute"></th:block>
								</div>
							</div>
							<!-- /.tab-pane -->
							<div class="tab-pane" id="tab_usergroup">
								<div class="box-body">
									<th:block layout:insert="/backoffice/adminlte/user/usergroupForm :: usergroup"></th:block>
								</div>
							</div>
							<!-- /.tab-pane -->
							<div class="tab-pane" id="tab_userauthority">
								<div class="box-body">
									<th:block layout:insert="/backoffice/adminlte/user/usergroupForm :: userauthority"></th:block>
								</div>
							</div>
							<!-- /.tab-pane -->
							<div class="tab-pane" id="tab_administration">
								<div class="box-body">
									<th:block layout:insert="/backoffice/adminlte/user/usergroupForm :: administration"></th:block>
								</div>
							</div>
							<!-- /.tab-pane -->
						</div>
						<!-- /.tab-content -->
					</div>
					<!-- nav-tabs-custom -->
				</div>
				<!-- /.col -->
			</div>
		</form>
		<div class="modal fade" id="modal-delete">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
						<h4 class="modal-title" th:text="#{module.backoffice.delete.confirm}"></h4>
					</div>
					<div class="modal-body" th:utext="#{module.backoffice.delete.confirm.info}"></div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default pull-left" data-dismiss="modal" th:text="'  '+#{module.backoffice.no}+'  '"></button>
						<form id="delete-usergroup-form" th:action="@{${@environment.getProperty('path.usergroup')}}" method="post" th:object="${usergroupSearch}">
							<input type="hidden" name="delete">
							<input type="hidden" name="page" th:value="${pagination.getNumber()+1}">
							<input type="hidden" name="size" th:value="${pagination.getSize()}">
							<input type="hidden" name="direction" th:value="${direction}">
							<input type="hidden" name="properties" th:value="${properties}">
							<input type="hidden" name="idSearch" th:value="${usergroupSearch.idSearch}">
							<input type="hidden" name="uuid" th:value="${usergroupUpdate.uuid}">
							<button type="submit" class="btn btn-danger" th:text="#{module.backoffice.delete}"></button>
						</form>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal-dialog -->
		</div>
		<!-- /.modal -->
		<script th:inline="javascript">
		    /*<![CDATA[*/
		    	
		    var locale = /*[[${#locale}]]*/;
		    
		    $(document).ready(function() {
		    	
		    	$('#usergroupTable').DataTable({
		    		  'language' : {
				        'url' : '/static/common/plugin/datatables/language/'+locale+'.json'
				      },
		    	      'pageLength'  : 10,
		    	      'paging'      : true,
		    	      'lengthChange': false,
		    	      'searching'   : true,
		    	      'ordering'    : true,
		    	      'info'        : false,
		    	      'autoWidth'   : true
		    	})
		        
		        $('#usergroup-update-form').validate({
		            rules: {
		                    required: true,
		                    remote: {
		                        url: /*[[${@environment.getProperty('path.api.usergroup.checkid')}]]*/ ,
		                        type: "get",
		                        data: {
		                            uuid: /*[[${usergroupUpdate.uuid}]]*/ ,
		                            id: function() {
		                                return $("#usergroup-update-form input[name='id']").val();
		                            }
		                        }
		                    }
		            },
		            messages: {
		                id: {
		                    required: /*[[#{module.usergroup.id.required}]]*/ ,
		                    remote: /*[[#{module.usergroup.id.exists}]]*/
		                }
		            },
		            highlight: function(element) {
		                $(element).closest('.form-group').addClass('has-error');
		            },
		            unhighlight: function(element) {
		                $(element).closest('.form-group').removeClass('has-error');
		                $(element).closest('.form-group').find('.help-block').html('');
		            },
		            errorPlacement: function(error, element) {
		                element.closest('.form-group').find('.help-block').html(error.text());
		            }
		        });
		
		    });
		    /*]]>*/
		</script>
	</th:block>
</body>
</html>