<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
	layout:decorate="${@environment.getProperty('layout.backoffice')}">
<head>
<title th:text="#{module.cronjob}"></title>
</head>
<body>
	<th:block layout:fragment="update">
		<form id="update-form" role="form" th:action="${@environment.getProperty('path.cronjob')}" method="post" th:object="${cronjobUpdate}">
			<input type="hidden" name="update" />
			<input type="hidden" name="uuid" th:value="${cronjobUpdate.uuid}" />
			<input type="hidden" name="page" th:value="${pagination.getNumber()+1}">
			<input type="hidden" name="size" th:value="${pagination.getSize()}">
			<input type="hidden" name="direction" th:value="${direction}">
			<input type="hidden" name="properties" th:value="${properties}">
			<input type="hidden" name="cronjobSearch.searchAll" th:value="${objectSearch.searchAll}" class="form-control">
			<input type="hidden" th:each="field : ${searchFields}" th:name="'cronjobSearch.'+${field}" th:value="${objectSearch.__${field}__}" class="form-control">
			<div class="row">
				<div class="col-md-12">
					<div class="box box-solid">
						<div class="box-body bg-gray">
							<div class="row">
								<div class="col-xs-4 col-sm-6 col-md-6 col-lg-6">
									<th:block layout:insert="/backoffice/adminlte/common/component/delete :: button (deleteAuthority='cronjob_delete')"></th:block>
								</div>
								<div class="col-xs-8 col-sm-6 col-md-6 col-lg-6" style="text-align: right">
									<th:block layout:insert="/backoffice/adminlte/common/component/refresh :: button (deleteAuthority='cronjob_delete')"></th:block>
									<th:block layout:insert="/backoffice/adminlte/common/component/update :: button (updateAuthority='cronjob_update')"></th:block>
								</div>
							</div>
						</div>
						<!-- /.box-header -->
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<!-- Custom Tabs -->
					<div class="nav-tabs-custom">
						<ul class="nav nav-tabs">
							<li class="active">
								<a href="#tab_general" data-toggle="tab" th:text="#{module.backoffice.general}" onclick="changeTab('general')"></a>
							</li>
							<li>
								<a href="#tab_jobstatus" data-toggle="tab" th:text="#{module.cronjob.jobstatus}" onclick="changeTab('jobstatus')"></a>
							</li>
							<li>
								<a href="#tab_history" data-toggle="tab" th:text="#{module.backoffice.history}" onclick="changeTab('history')"></a>
							</li>
							<li>
								<a href="#tab_administration" data-toggle="tab" th:text="#{module.backoffice.administration}" onclick="changeTab('administration')"></a>
							</li>
						</ul>
						<div class="tab-content">
							<div class="tab-pane active" id="tab_general">
								<div class="box-body">

									<th:block layout:insert="/backoffice/adminlte/common/component/general :: general"></th:block>

									<div class="row" style="border-top: 1px solid #f4f4f4; padding-top: 10px;">
										<div class="col-md-6">
											<div class="form-group">
												<label for="jobClass" th:text="#{module.cronjob.jobclass}"></label>
												<input type="text" class="form-control" name="jobClass" th:value="*{jobClass}">
												<span class="help-block"></span>
											</div>
											<div class="form-group">
												<label for="jobGroup" th:text="#{module.cronjob.jobgroup}"></label>
												<input id="jobGroup" type="text" class="form-control" name="jobGroup" th:value="*{jobGroup}">
												<span class="help-block"></span>
											</div>
											<div class="form-group">
												<label for="jobName" th:text="#{module.cronjob.jobname}"></label>
												<input id="jobName" type="text" class="form-control" name="jobName" th:value="*{jobName}">
												<span class="help-block"></span>
											</div>
										</div>
										<div class="col-md-6">
											<div class="form-group">
												<label for="cronExpression" th:text="#{module.cronjob.cronexpression}"></label>
												<input type="text" class="form-control" name="cronExpression" th:value="*{cronExpression}">
												<span class="help-block"></span>
											</div>
											<div class="form-group">
												<label for="startup" th:text="#{module.cronjob.startup}"></label>
												<select class="form-control" name="startup">
													<option value="1" th:selected="*{startup == true}" th:text="#{module.backoffice.yes}"></option>
													<option value="0" th:selected="*{startup == false}" th:text="#{module.backoffice.no}"></option>
												</select>
												<span class="help-block"></span>
											</div>
											<div class="form-group">
												<label for="description" th:text="#{module.cronjob.description}"></label>
												<textarea type="text" class="form-control" name="description" th:text="*{description}"></textarea>
												<span class="help-block"></span>
											</div>
										</div>
										<div class="col-md-12" th:if="*{uuid != null}">
											<label for="startup" th:text="#{module.cronjob.jobdata}"></label>
											<table id="jobdatasTable" class="table table-bordered table-hover">
												<thead>
													<tr>
														<th th:text="#{module.cronjob.jobdata.name}"></th>
														<th th:text="#{module.cronjob.jobdata.value}"></th>
														<th style="width: 70px" class="action" sec:authorize="hasAuthority('cronjob_update')" th:text="#{module.backoffice.action}"></th>
													</tr>
												</thead>
												<tbody>
													<tr th:each="row : ${cronjobUpdate.cronjobDatas}">
														<td th:text="${row.name}"></td>
														<td th:text="${row.value}"></td>
														<td sec:authorize="hasAuthority('cronjob_update')">
															<button type="button" class="btn btn-block btn-danger btn-sm" data-toggle="modal" data-target="#modal-deletejobdata" th:data-jobdatauuid="${row.uuid}"
																th:text="#{module.backoffice.delete}"></button>
														</td>
													</tr>
												</tbody>
												<tfoot sec:authorize="hasAuthority('cronjob_update')">
													<tr>
														<td colspan="2"></td>
														<td>
															<!-- Button trigger modal -->
															<a class="btn btn-block btn-default" data-toggle="modal" data-target="#modal-createjobdata">
																<span class="fa fa-plus color"></span>
																<span th:text="#{module.backoffice.add}"></span>
															</a>
														</td>
													</tr>
												</tfoot>
											</table>
										</div>
									</div>
								</div>
								<!-- /.box-body -->
							</div>
							<!-- /.tab-pane -->
							<div class="tab-pane" id="tab_jobstatus">
								<div class="box-body">
									<th:block layout:insert="/backoffice/adminlte/cronjob/cronjobForm :: jobstatus"></th:block>
								</div>
							</div>
							<!-- /.tab-pane -->
							<div class="tab-pane" id="tab_history">
								<div class="box-body">
									<th:block layout:insert="/backoffice/adminlte/common/component/history :: history"></th:block>
								</div>
							</div>
							<!-- /.tab-pane -->
							<div class="tab-pane" id="tab_administration">
								<div class="box-body">
									<th:block layout:insert="/backoffice/adminlte/common/component/administration :: administration"></th:block>
								</div>
							</div>
							<!-- /.tab-pane -->
						</div>
						<!-- /.tab-content -->
					</div>
					<!-- nav-tabs-custom -->
				</div>
				<!-- /.col -->
			</div>
		</form>
		<script th:inline="javascript">
		    /*<![CDATA[*/
		    $(document).ready(function() {
		        $('#update-form').validate({
		        	onfocusout: false,
		            invalidHandler: function(form, validator) {
		                var errors = validator.numberOfInvalids();
		                if (errors) {                    
		                    validator.errorList[0].element.focus();
		                }
		            },
		            rules: {
		            	id: {
		                    required: true,
		                    remote: {
		                        url: /*[[${@environment.getProperty('path.api.cronjob.checkid')}]]*/ ,
		                        type: "get",
		                        data: {
		                            uuid: /*[[${cronjobUpdate.uuid}]]*/ ,
		                            id: function() {
		                                return $("#update-form input[name='id']").val();
		                            }
		                        }
		                    }
		                }
		            },
		            messages: {
		                id: {
		                    required: /*[[#{module.backoffice.id.required}]]*/ ,
		                    remote: /*[[#{module.backoffice.id.exists}]]*/
		                }
		            },
		            highlight: function(element) {
		                $(element).closest('.form-group').addClass('has-error');
		            },
		            unhighlight: function(element) {
		                //$(element).closest('.form-group').removeClass('has-error');
		                //$(element).closest('.form-group').find('.help-block').html('');
		            },
		            errorPlacement: function(error, element) {
		                element.closest('.form-group').find('.help-block').html(error.text());
		            }
		        });
		
		    });
		    /*]]>*/
		</script>

		<th:block
			layout:insert="/backoffice/adminlte/common/component/delete :: delete (deleteAction=@{${@environment.getProperty('path.cronjob')}}, objectSearch=${cronjobSearch}, deleteUuid=${cronjobUpdate.uuid})"></th:block>
	</th:block>
	<th:block layout:fragment="jobstatus">
		<div class="row">
			<div class="col-md-6">
				<div class="form-group">
					<label for="status" th:text="#{module.cronjob.status} + ':'"></label>
					<span class="text-block" th:text="*{status}"></span>
				</div>
				<div class="form-group">
					<label for="result" th:text="#{module.cronjob.result} + ':'"></label>
					<span class="text-block" th:text="*{result}"></span>
				</div>
				<div class="form-group">
					<label for="result" th:text="#{module.cronjob.message} + ':'"></label>
					<span class="text-block" th:text="*{message}"></span>
				</div>
			</div>
			<div class="col-md-6">
				<div class="form-group">
					<label for="lastStartExecutedDate" th:text="#{module.cronjob.laststartexecuteddate} + ':'"></label>
					<span class="text-block" th:text="*{lastStartExecutedDate != null} ? *{#dates.format(lastStartExecutedDate, ' dd MMMM yyyy hh:mma')}"></span>
				</div>
				<div class="form-group">
					<label for="lastFinishExecutedDate" th:text="#{module.cronjob.lastfinishexecuteddate} + ':'"></label>
					<span class="text-block" th:text="*{lastFinishExecutedDate != null} ? *{#dates.format(lastFinishExecutedDate, ' dd MMMM yyyy hh:mma')}"></span>
				</div>
			</div>
		</div>
	</th:block>
</body>
</html>